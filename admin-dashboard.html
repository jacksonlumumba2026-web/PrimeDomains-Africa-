<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | PrimeDomains Africa</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>
body{margin:0;font-family:"Poppins",sans-serif;background:#f5f7fa;}
nav{background:#0d1b2a;color:white;padding:20px;display:flex;justify-content:space-between;align-items:center;}
nav h1{margin:0;}
nav button{padding:8px 15px;border:none;border-radius:5px;background:#00b4d8;color:white;cursor:pointer;}
nav button:hover{background:#0096c7;}
header{padding:30px;text-align:center;}
.stats{display:flex;gap:25px;justify-content:center;margin-bottom:40px;flex-wrap:wrap;}
.stat-box{background:white;padding:25px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);flex:1;text-align:center;min-width:180px;margin-bottom:15px;}
.stat-box h3{margin-bottom:10px;}
section{padding:20px;}
table{width:100%;border-collapse:collapse;background:white;border-radius:10px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
table th, table td{padding:12px;text-align:left;border-bottom:1px solid #eee;}
table th{background:#0d1b2a;color:white;}
.approve-btn, .reject-btn{
  padding:5px 10px;
  border:none;
  border-radius:5px;
  cursor:pointer;
  margin-right:5px;
  color:white;
}
.approve-btn{background:#28a745;}
.reject-btn{background:#dc3545;}
.approve-btn:hover{opacity:0.8;}
.reject-btn:hover{opacity:0.8;}
</style>
</head>

<body>

<!-- NAV -->
<nav>
<h1>Admin Panel</h1>
<button onclick="logout()">Logout</button>
</nav>

<!-- HEADER -->
<header>
<h2>Welcome, Admin</h2>
<p>Monitor users, domains, and platform earnings.</p>
</header>

<!-- STATS -->
<div class="stats">
<div class="stat-box">
<h3 id="totalUsers">0</h3>
<p>Total Users</p>
</div>
<div class="stat-box">
<h3 id="totalDomains">0</h3>
<p>Total Domains</p>
</div>
<div class="stat-box">
<h3 id="totalSales">0</h3>
<p>Total Sales</p>
</div>
<div class="stat-box">
<h3 id="totalEarnings">$0</h3>
<p>Total Earnings</p>
</div>
</div>

<!-- USERS TABLE -->
<section>
<h3>Users</h3>
<table id="usersTable">
<tr>
<th>Email</th>
<th>Role</th>
<th>Status</th>
</tr>
</table>
</section>

<!-- DOMAINS TABLE -->
<section>
<h3>Domains</h3>
<table id="domainsTable">
<tr>
<th>Domain Name</th>
<th>Seller</th>
<th>Price</th>
<th>Status</th>
<th>Actions</th>
</tr>
</table>
</section>

<script type="module">

import { auth, db } from "./firebase-config.js";
import { signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// Logout Function
window.logout = function() {
signOut(auth).then(()=>{window.location.href="login.html";});
}

// Approve Domain
async function approveDomain(domainId){
  const domainRef = doc(db,"domains",domainId);
  await updateDoc(domainRef,{status:"approved"});
  alert("Domain approved");
  location.reload();
}

// Reject Domain
async function rejectDomain(domainId){
  const domainRef = doc(db,"domains",domainId);
  await updateDoc(domainRef,{status:"rejected"});
  alert("Domain rejected");
  location.reload();
}

// Load Stats & Tables
async function loadAdminData(){

  // USERS
  const usersSnap = await getDocs(collection(db,"users"));
  document.getElementById("totalUsers").innerText = usersSnap.size;
  const usersTable = document.getElementById("usersTable");
  usersTable.innerHTML = `<tr>
  <th>Email</th><th>Role</th><th>Status</th></tr>`;
  usersSnap.forEach(doc=>{
    const data = doc.data();
    usersTable.innerHTML += `<tr>
      <td>${data.email}</td>
      <td>${data.role}</td>
      <td>${data.status}</td>
    </tr>`;
  });

  // DOMAINS
  const domainsSnap = await getDocs(collection(db,"domains"));
  document.getElementById("totalDomains").innerText = domainsSnap.size;
  const domainsTable = document.getElementById("domainsTable");
  domainsTable.innerHTML = `<tr>
<th>Domain Name</th><th>Seller</th><th>Price</th><th>Status</th><th>Actions</th></tr>`;
  let totalEarnings = 0;
  domainsSnap.forEach(doc=>{
    const data = doc.data();
    const id = doc.id;
    domainsTable.innerHTML += `<tr>
      <td>${data.name}</td>
      <td>${data.seller}</td>
      <td>$${data.price}</td>
      <td>${data.status || "pending"}</td>
      <td>
        <button class="approve-btn" onclick="approveDomain('${id}')">Approve</button>
        <button class="reject-btn" onclick="rejectDomain('${id}')">Reject</button>
      </td>
    </tr>`;
    if(data.status==="approved") totalEarnings += parseFloat(data.price);
  });
  document.getElementById("totalEarnings").innerText = `$${totalEarnings}`;
}

loadAdminData();

</script>

</body>
</html>
